% Add some TODO notes for the writer's own use.
\usepackage[disable]{todonotes}

% Used for citations & references
\usepackage{biblatex}
\addbibresource{inc/citations.bib}

% Compile using UTF-8
\usepackage[utf8]{inputenc}

% This package combines longtable and tabularx
\usepackage{xltabular}

% Add the highlighted notes that appear when the reader hovers
\usepackage{acro}
\usepackage{pdfcomment}

% Get some nice pre-defined colors.
% Start here: https://ctan.math.ca/tex-archive/macros/latex/contrib/xkcdcolors/xkcdcolors-manual.pdf
% See the git page: https://github.com/Rmano/xkcdcolors
% See the full list here: https://xkcd.com/color/rgb/
% See here for the story: https://blog.xkcd.com/2010/05/03/color-survey-results/
\usepackage{xkcdcolors}

% Define coloring related to terms
% I am using "Contrasting Palette 1 & 2" from https://venngage.com/tools/accessible-color-palette-generator
\definecolor{ocre}{RGB}{196, 70, 1} % Define the color used for highlighting throughout the boo

\colorlet{colorBgMundane}{xkcdCloudyBlue}
\colorlet{colorBgModern}{xkcdPowderBlue}
\colorlet{colorBgMedieval}{xkcdSandy}
\colorlet{colorBgBeyondMundane}{xkcdSpearmint}

\colorlet{colorCapabilityDark}{xkcdLightPlum}
\colorlet{colorCapability}{xkcdLightPink}
\colorlet{colorCapabilityLight}{xkcdVeryLightPink}
\colorlet{colorCapabilityContour}{xkcdVeryLightPink}

\colorlet{colorBonusDark}{xkcdMutedBlue}
\colorlet{colorBonus}{xkcdBabyBlue}
\colorlet{colorBonusLight}{xkcdIce}
\colorlet{colorBonusContour}{white}

\colorlet{colorPropertyDark}{xkcdDirtyOrange}
\colorlet{colorProperty}{xkcdLightMustard}
\colorlet{colorPropertyLight}{xkcdParchment}
\colorlet{colorPropertyContour}{xkcdOffWhite}

\colorlet{colorBeyond}{xkcdHunterGreen}

\colorlet{colorParchment}{orange!30!black!10}

% TODO: Remove colorCoreCompetency if not being used.
\colorlet{colorCoreCompetency}{colorCapabilityDark}
\newcommand{\termCore}[1]{\textcolor{colorCapabilityDark}{#1}}
\newcommand{\termBonus}[1]{\textcolor{colorBonusDark}{#1}}
\newcommand{\termDifficultyLevel}[1]{\textcolor{colorPropertyDark}{#1}}


% TODO: This needs to be black & boldface
\definecolor{colorTerm}{RGB}{196, 70, 1}
\newcommand{\term}[1]{\emph{#1}}
\newcommand{\termBeyond}[1]{\textcolor{colorBeyond}{#1}}

% TODO: Currently not using the following, remove if I never wind up using it.
\newcommand{\termClass}[1]{\textcolor{xkcdSpearmint}{#1}}

% Add the nice side tabs on the tables.
% Usage: Put into the rightmost cell in a tabularx environment.
% Example: \sideTab{LightBlue}{Modern}
\newcommand{\sideTab}[2]{\cellcolor{#1} \rotatebox[origin=l]{270}{#2}}
\newcommand{\rightSideTab}[2]{\cellcolor{#1} \rotatebox[origin=l]{270}{#2}}
\newcommand{\leftSideTab}[2]{\cellcolor{#1} \rotatebox[origin=r]{90}{#2}}


% Add color to table cells
% See here: https://tex.stackexchange.com/questions/50349/color-only-a-cell-of-a-table
\usepackage{colortbl}

% Use this package to break up a list into multiple columns
\usepackage{multicol}

% Add styling to emphasized paragraphs and character sheets
\usepackage{mdframed}

% TODO: Remove the following
% \global\mdfdefinestyle{d20ComparisonBoxStyle}{
% 	linewidth=1pt,
% 	linecolor=xkcdSandy,
% 	frametitlebackgroundcolor=xkcdPale,
% 	backgroundcolor=xkcdOffWhite,
% 	frametitlefont=\bfseries\sffamily\footnotesize,
% 	frametitlerule=true,
% }





% Style the bullets in itemized lists
% https://tex.stackexchange.com/questions/42805/what-are-original-itemize-bullet-definitions
\renewcommand\labelitemi{\textbullet}
\renewcommand\labelitemii{\normalfont\bfseries \textendash}
\renewcommand\labelitemiii{\textasteriskcentered}
\renewcommand\labelitemiv{\textperiodcentered}


\newcommand{\hover}[2]{
	\pdfmarkupcomment[markup=Highlight,disable=false,color=LightYellow]{#1}{#2}
}

\newcommand{\acronym}[2]{
	\pdfmarkupcomment[markup=Underline,disable=false,color=colorTerm]{#1}{#2}
}

\newcommand{\acronymDL}[1]{
	\pdfmarkupcomment[markup=Underline,disable=false,color=colorPropertyDark]{DL}{
		Difficulty Level (DL): A roll has to beat this level number to succeed.
	}
}

\newcommand{\footnoteMundaneAnimals}{Small mammals, large mammals, small reptiles, large reptiles, small birds, birds of prey}

\usepackage{wrapfig}

% Add tikzpicture to use for sheets
\usepackage{tikz}
\usetikzlibrary{positioning, calc, shadings, decorations.pathmorphing}

% Font for handwriting. Run udpmap to compile.
\usepackage{emerald}

% Font for titles. Run udpmap to compile.
\usepackage{comfortaa}

% Is this used? Test and remove if not used.
\usepackage{makecell}

% Useful for creating environments in an easier format.
\usepackage{environ}

% Expand table cells into multiple rows
\usepackage{multirow}


% Set and reset variables based on the hack here:
% https://tex.stackexchange.com/questions/37094/what-is-the-recommended-way-to-assign-a-value-to-a-variable-and-retrieve-it-for
\usepackage{pgfkeys}

% This is for the marginfigure environment.
\usepackage{sidenotes}

\newcommand{\setval}[1]{\pgfkeys{/variables/#1}}
\newcommand{\getval}[1]{\pgfkeysvalueof{/variables/#1}}
\newcommand{\declare}[1]{%
 \pgfkeys{
  /variables/#1.is family,
  /variables/#1.unknown/.style = {\pgfkeyscurrentpath/\pgfkeyscurrentname/.initial = ##1}
 }%
}

\declare{}

\newcommand{\cardwidth}{}
\newcommand{\sheetwidth}{}

\newenvironment{actorSheet}[5]{
	\setval{widthCapability = 25mm}
	\setval{widthBonus = 25mm}
	\setval{widthProperty = 25mm}
	\setval{widthExpertise = 25mm}

	% Not tested.
	\renewcommand{\cardwidth}{#2}
	\renewcommand{\sheetwidth}{#2}
	% TODO: Add height if this works

	\begin{tikzpicture}
		\draw[color=#5,line width=2mm]
			(#2, 0) coordinate (#1_SE) {} -- (0,  0) coordinate (#1_SW) {}
		;
		\draw[color=#5,line width=2pt]
			(0, #3) coordinate (#1_NW) {} -- (#2,#3) coordinate (#1_NE) {}
	   ;
	   \node[below right=1.5mm and -7.5pt of #1_NW,anchor=north west,inner sep=0,outer sep=0] (#1_title) {
			\setlength{\extrarowheight}{1.6mm}
			\setlength{\tabcolsep}{0mm}
			\setlength{\arraycolsep}{0mm}
			\begin{tabular}{@{}p{#2}}
				\cellcolor{#5} \hspace*{10mm} \ECFDecadenceInTheDarkCondensed #4\\[.9mm]
			\end{tabular}
	   };
}{
	\end{tikzpicture}
}
% TODO: Adjust the hspace depending on the card dimensions. Package calc or pgf?


\newenvironment{actorCardLetterSizeFitToPage}[3]{
	\begin{actorSheet}{#1}{\textwidth}{1.29411764706 * \textwidth}{#2}{#3}
	\setval{widthCapability = 29.75mm}
	\setval{widthBonus = 29.75mm}
	\setval{widthProperty = 15mm}
	\setval{widthExpertise = 26.75
	mm}
}{
	\end{actorSheet}
}

\newenvironment{actorCardStandardSize}[3]{
	\begin{actorSheet}{#1}{2.5in}{3.5in}{#2}{#3}
}{
	\end{actorSheet}
}

\newenvironment{actorCardTarotSize}[3]{
	\begin{actorSheet}{#1}{7cm}{12cm}{#2}{#3}
}{
	\end{actorSheet}
}

\newenvironment{actorCardMiniEuro}[3]{
	\begin{actorSheet}{#1}{44mm}{68mm}{#2}{#3}
	\setval{widthCapability = 32.5mm}
	\setval{widthExpertise = 20mm}
}{
	\end{actorSheet}
}

\newenvironment{actorCardMiniAmerican}[3]{
	\begin{actorSheet}{#1}{41mm}{63mm}{#2}{#3}
}{
	\end{actorSheet}
}

\NewEnviron{capabilitiesBox}[1]{
	\node[
			draw=colorCapabilityDark,
			below left=11 mm and 0 in of #1_NW,
			top color=colorCapability,
			middle color=colorCapabilityLight,
			bottom color=colorCapabilityContour,
			anchor=north west,
			inner ysep=0mm,
			inner xsep=0mm,
	] (#1_capabilitiesBox){
		\BODY
	};
}

\NewEnviron{capabilitiesTable}[1]{
	\begin{tabularx}{\getval{widthCapability}}[t]{Xr}
		\multicolumn{2}{c}{
			\cellcolor{colorCapabilityDark}
			\textcolor{colorCapabilityContour}{
				\comfortaa\footnotesize #1
			}
		} \\
		\BODY \\
	\end{tabularx}
}

\NewEnviron{speciesBonusBox}[1]{
	\node[
			draw=colorBonusDark,
			below left=4mm and 0mm of #1_capabilitiesBox,
			top color=colorBonus,
			middle color=colorBonusLight,
			bottom color=colorBonusContour,
			anchor=north west,
			inner ysep=0mm,
			inner xsep=0mm
	] (#1_speciesBonusBox){
		\BODY
	};
}

\NewEnviron{bonusTable}[1]{
	\begin{tabularx}{\getval{widthBonus}}[t]{Xr}
		\multicolumn{2}{c}{
			\cellcolor{colorBonusDark}
			\textcolor{colorBonusContour}{
				\comfortaa\footnotesize #1
			}
		} \\
		\BODY
	\end{tabularx}
}

\newcommand{\expertiseTable}[5]{
	\node[
		draw=colorBonusDark,
		top color=colorBonus,
		middle color=colorBonusLight,
		bottom color=colorBonusContour,
		font=\normalsize,
		below left=4mm and 0mm of #1_speciesBonusBox,
		anchor=north west,
		line width=.5mm,
		inner ysep=0mm,
		inner xsep=0mm
	] (#1_tableExpertise){
		\begin{tabular}[t]{c|c|c|c}
			\rowcolor{colorBonusDark}
			\sffamily\footnotesize\textcolor{colorBonusContour}{Training}	&
			\sffamily\footnotesize\textcolor{colorBonusContour}{Skills}		&
			\sffamily\footnotesize\textcolor{colorBonusContour}{Knowledge}	&
			\sffamily\footnotesize\textcolor{colorBonusContour}{Talents} \\
			\begin{tabularx}{\getval{widthExpertise}}[t]{Xr}#2\end{tabularx}	&
			\begin{tabularx}{\getval{widthExpertise}}[t]{Xr}#3\end{tabularx} 	&
			\begin{tabularx}{\getval{widthExpertise}}[t]{Xr}#4\end{tabularx}	&
			\begin{tabularx}{\getval{widthExpertise}}[t]{Xr}#5\end{tabularx}
		\end{tabular}
	};
}



\newcommand{\capability}[2]{
	\\[-3mm]
	\footnotesize #1 & \ECFAugie\footnotesize #2 \\
	\hline
}

\newcommand{\bonus}[2]{
	\footnotesize #1 & \footnotesize #2 \\
	\hline
}

\newcommand{\expertise}[2]{
	\ECFAugie\footnotesize #1 & \ECFAugie\footnotesize #2 \\
	\hline
}

% \newcommand{\propertyLine}[2]{
% 	\footnotesize #1 & \footnotesize #2 \\
% }


% \newcommand{\labeledFrame}[4]{
% 	\node[draw=xkcdLightPlum,top color=xkcdLightPink,middle color=xkcdVeryLightPink,bottom color=white,font=\normalsize,#3,anchor=north west,line width=.5mm,inner ysep=1mm,inner xsep=2mm] (#1){
% 		#4
% 	};
% 	\node[text=xkcdVeryLightPink,fill=xkcdLightPlum,node font=\sffamily,below right=0.2mm and -0.1mm of #1.north west,anchor=south west] (#1Label)  {
% 		\hspace*{5mm}#2
% 	};
% 	\coordinate[below right=.2mm and -.1mm of #1Label.north east,anchor=west] (#1A);
% 	\coordinate[right=-.1mm of #1Label.south east,anchor=west] (#1B);
% 	\coordinate[left=.6mm of #1.north east,anchor=south west] (#1C);
% 	\draw[xkcdLightPlum,fill=xkcdLightPlum] (#1A) -- (#1B) -- (#1C) -- (#1A);
% }


% Add a "parchment" environment for shaded paragraphs
% https://texample.net//tikz/examples/framed-tikz/

%%%%%%%%%%%%%%%%%%% BEGIN %%%%%%%%%%%%%%%%%%%%%%
\usepackage{framed}
\pgfmathsetseed{1} % To have predictable results
\pgfdeclarelayer{background}
\pgfsetlayers{background,main}

% define styles for the normal border and the torn border
\tikzset{
  normal border/.style={orange!30!black!10, decorate,
     decoration={random steps, segment length=2.5cm, amplitude=.7mm}},
  torn border/.style={orange!30!black!5, decorate,
     decoration={random steps, segment length=.5cm, amplitude=1.7mm}}}

% Macro to draw the shape behind the text, when it fits completly in the
% page
\def\parchmentframe#1{
\tikz{
  \node[inner sep=2em] (A) {#1};  % Draw the text of the node
  \begin{pgfonlayer}{background}  % Draw the shape behind
  \fill[normal border]
        (A.south east) -- (A.south west) --
        (A.north west) -- (A.north east) -- cycle;
  \end{pgfonlayer}}}

% Macro to draw the shape, when the text will continue in next page
\def\parchmentframetop#1{
\tikz{
  \node[inner sep=2em] (A) {#1};    % Draw the text of the node
  \begin{pgfonlayer}{background}
  \fill[normal border]              % Draw the ``complete shape'' behind
        (A.south east) -- (A.south west) --
        (A.north west) -- (A.north east) -- cycle;
  \fill[torn border]                % Add the torn lower border
        ($(A.south east)-(0,.2)$) -- ($(A.south west)-(0,.2)$) --
        ($(A.south west)+(0,.2)$) -- ($(A.south east)+(0,.2)$) -- cycle;
  \end{pgfonlayer}}}

% Macro to draw the shape, when the text continues from previous page
\def\parchmentframebottom#1{
\tikz{
  \node[inner sep=2em] (A) {#1};   % Draw the text of the node
  \begin{pgfonlayer}{background}
  \fill[normal border]             % Draw the ``complete shape'' behind
        (A.south east) -- (A.south west) --
        (A.north west) -- (A.north east) -- cycle;
  \fill[torn border]               % Add the torn upper border
        ($(A.north east)-(0,.2)$) -- ($(A.north west)-(0,.2)$) --
        ($(A.north west)+(0,.2)$) -- ($(A.north east)+(0,.2)$) -- cycle;
  \end{pgfonlayer}}}

% Macro to draw the shape, when both the text continues from previous page
% and it will continue in next page
\def\parchmentframemiddle#1{
\tikz{
  \node[inner sep=2em] (A) {#1};   % Draw the text of the node
  \begin{pgfonlayer}{background}
  \fill[normal border]             % Draw the ``complete shape'' behind
        (A.south east) -- (A.south west) --
        (A.north west) -- (A.north east) -- cycle;
  \fill[torn border]               % Add the torn lower border
        ($(A.south east)-(0,.2)$) -- ($(A.south west)-(0,.2)$) --
        ($(A.south west)+(0,.2)$) -- ($(A.south east)+(0,.2)$) -- cycle;
  \fill[torn border]               % Add the torn upper border
        ($(A.north east)-(0,.2)$) -- ($(A.north west)-(0,.2)$) --
        ($(A.north west)+(0,.2)$) -- ($(A.north east)+(0,.2)$) -- cycle;
  \end{pgfonlayer}}}

% Define the environment which puts the frame
% In this case, the environment also accepts an argument with an optional
% title (which defaults to ``Example'', which is typeset in a box overlaid
% on the top border
\newenvironment{parchment}[1][Example]{%
  \def\FrameCommand{\parchmentframe}%
  \def\FirstFrameCommand{\parchmentframetop}%
  \def\LastFrameCommand{\parchmentframebottom}%
  \def\MidFrameCommand{\parchmentframemiddle}%
  \vskip\baselineskip
  \MakeFramed {\FrameRestore}
  \noindent\tikz\node[inner sep=1ex, draw=black!20,fill=white,
          anchor=west, overlay] at (0em, 2em) {\sffamily#1};\par}%
{\endMakeFramed}
%%%%%%%%%%%%%%%%%%%% END %%%%%%%%%%%%%%%%%%%%%%%


% Side notes
\NewEnviron{formula}[1]{
	\begin{center}
		\begin{minipage}{3.5in}
			\begin{parchment}[#1]
				\centering
				\BODY
			\end{parchment}
		\end{minipage}
	\end{center}
}

\NewEnviron{marginNote}{
	\marginpar{
		\begin{mdframed}[backgroundcolor=colorParchment,linewidth=0pt]
			\footnotesize
			\BODY
		\end{mdframed}
	}
}

% Emphasis paragraph
\global\mdfdefinestyle{emphasisParagraphFrameStyle}{
	topline=false,
	bottomline=false,
	rightline=false,
	skipabove=\topsep,
	skipbelow=\topsep,
	linecolor=xkcdBottleGreen,
	linewidth=3pt,
}

\newenvironment{emphasisParagraph}{
	\begin{quote}
	\begin{mdframed}[style=emphasisParagraphFrameStyle]
	\em
}{
	\end{mdframed}
	\end{quote}
}
